---
author: mcleanbyron
ms.assetid: D1F233EC-24B5-4F84-A92F-2030753E608E
description: Use this method in the Windows Store collection API to get all the products that a customer owns for apps that are associated with your Azure AD client ID. You can scope your query to a particular product, or use other filters.
title: Query for products
translationtype: Human Translation
ms.sourcegitcommit: 6d0fa3d3b57bcc01234aac7d6856416fcf9f4419
ms.openlocfilehash: ea517d66dbb6f373b191937de8c1cbe42c74846f

---

# Query for products




Use this method in the Windows Store collection API to get all the products that a customer owns for apps that are associated with your Azure AD client ID. You can scope your query to a particular product, or use other filters.

This method is designed to be called by your service in response to a message from your app. Your service should not regularly poll for all users on a schedule.

## Prerequisites


To use this method, you will need:

-   An Azure AD access token that was created with the `https://onestore.microsoft.com` audience URI.
-   A Windows Store ID key that was generated by calling the [**GetCustomerCollectionsIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608674) method from client-side code in your app.

For more information, see [View and grant products from a service](view-and-grant-products-from-a-service.md).

## Request

### Request syntax

| Method | Request URI                                                 |
|--------|-------------------------------------------------------------|
| POST   | ```https://collections.mp.microsoft.com/v6.0/collections/query``` |

<span/>
 
### Request header

| Header         | Type   | Description                                                                                           |
|----------------|--------|-------------------------------------------------------------------------------------------------------|
| Authorization  | string | Required. The Azure AD access token in the form **Bearer** &lt;*token*&gt;.                           |
| Host           | string | Must be set to the value **collections.mp.microsoft.com**.                                            |
| Content-Length | number | The length of the request body.                                                                       |
| Content-Type   | string | Specifies the request and response type. Currently, the only supported value is **application/json**. |

<span/>

### Request body

| Parameter         | Type         | Description                                                                                                                                                                                                                                                          | Required |
|-------------------|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| beneficiaries     | UserIdentity | A UserIdentity object that represents the user being queried for products.                                                                                                                                                                                           | Yes      |
| continuationToken | string       | If there are multiple sets of products, the response body returns a continuation token when the page limit is reached. Provide that continuation token here in subsequent calls to retrieve remaining products.                                                      | No       |
| maxPageSize       | number       | The maximum number of products to return in one response. The default and maximum value is 100.                                                                                                                                                                      | No       |
| modifiedAfter     | datetime     | If specified, the service only returns products that have been modified after this date.                                                                                                                                                                             | No       |
| parentProductId   | string       | If specified, the service only returns add-ons that correspond to the specified app.                                                                                                                                                                                    | No       |
| productSkuIds     | ProductSkuId | If specified, the service only returns products applicable to the provided Product/SKU pairs.                                                                                                                                                                        | No       |
| productTypes      | string       | If specified, the service only returns products that match the specified product types. Supported product types are **Application**, **Durable**, and **UnmanagedConsumable**.                                                                                       | No       |
| validityType      | string       | When set to **All**, all products for a user will be returned, including expired items. When set to **Valid**, only products that are valid at this point in time are returned (that is, they have an active status, start date &lt; now, and end date is &gt; now). | No       |

<span/>

The UserIdentity object contains the following parameters.

| Parameter            | Type   | Description                                                                                                                                                                                                                  | Required |
|----------------------|--------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| identityType         | string | Specify the string value **b2b**.                                                                                                                                                                                            | Yes      |
| identityValue        | string | String value of the Windows Store ID key.                                                                                                                                                                                    | Yes      |
| localTicketReference | string | Requested identifier for the returned products. Returned items in the response body will have a matching *localTicketReference*. We recommend that you use the same value as the *userId* claim in the Windows Store ID key. | Yes      |

<span/> 

The ProductSkuId object contains the following parameters.

| Parameter | Type   | Description                                                                                                                                                                                                                                                                                                            | Required |
|-----------|--------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| productId | string | The Store ID from the Windows Store catalog. The Store ID is available on the [App identity page](../publish/view-app-identity-details.md) of the Dev Center dashboard. An example Store ID is 9WZDNCRFJ3Q8. | Yes      |
| skuID     | string | The SKU ID from the Windows Store catalog. An example SKU ID is “0010”.                                                                                                                                                                                                                                                | Yes      |

<span/>

### Request example

```syntax
POST https://collections.mp.microsoft.com/v6.0/collections/query HTTP/1.1
Authorization: Bearer eyJ0eXAiOiJKV1Q…….
Host: collections.mp.microsoft.com
Content-Length: 2531
Content-Type: application/json

{
  "maxPageSize": 100,
  "beneficiaries": [
    {
      "localTicketReference": "1055521810674918",
      "identityValue": "eyJ0eXAiOiJ……",
      "identityType": "b2b"
    }
  ],
  "modifiedAfter": "\/Date(-62135568000000)\/",
  "productSkuIds": [
    {
      "productId": "9NBLGGH5WVP6",
      "skuId": "0010"
    }
  ],
  "productTypes": [
    "UnmanagedConsumable"
  ],
  "validityType": "All"
}
```

## Response


### Response body

| Parameter         | Type                     | Description                                                                                                                                                                                | Required |
|-------------------|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| continuationToken | string                   | If there are multiple sets of products, this token is returned when the page limit is reached. You can specify this continuation token in subsequent calls to retrieve remaining products. | No       |
| Items             | CollectionItemContractV6 | An array of products for the specified user.                                                                                                                                               | No       |

<span/> 

The CollectionItemContractV6 object contains the following parameters.

| Parameter            | Type               | Description                                                                                                                                        | Required |
|----------------------|--------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| acquiredDate         | datetime           | The date on which the user acquired the item.                                                                                                      | Yes      |
| campaignId           | string             | The campaign ID that was provided at purchase time for this item.                                                                                  | No       |
| devOfferId           | string             | The offer ID from an in-app purchase.                                                                                                              | No       |
| endDate              | datetime           | The end date of the item.                                                                                                                          | Yes      |
| fulfillmentData      | string             | N/A                                                                                                                                                | No       |
| inAppOfferToken      | string             | The developer-specified product ID string that is assigned to the item in the Windows Dev Center dashboard. An example product ID is “product123”. | No       |
| itemId               | string             | An ID that identifies this collection item from other items the user owns. This ID is unique per product.                                          | Yes      |
| localTicketReference | string             | The ID of the previously supplied `localTicketReference` in the request body.                                                                      | Yes      |
| modifiedDate         | datetime           | The date this item was last modified.                                                                                                              | Yes      |
| orderId              | string             | If present, the order ID of which this item was obtained.                                                                                          | No       |
| orderLineItemId      | string             | If present, the line item of the particular order for which this item was obtained.                                                                | No       |
| ownershipType        | string             | The string “OwnedByBeneficiary”.                                                                                                                   | Yes      |
| productId            | string             | The Store ID for the app from the Windows Store catalog. An example Store ID is 9WZDNCRFJ3Q8.                                                            | Yes      |
| productType          | string             | One of the following product types: **Application**, **Durable**, and **UnmanagedConsumable**.                                                     | Yes      |
| purchasedCountry     | string             | N/A.                                                                                                                                               | No       |
| purchaser            | IdentityContractV6 | If present, this represents the identity of the purchaser of the item. See the details for this object below.                                      | No       |
| quantity             | number             | The quantity of the item. Currently, this will always be 1.                                                                                        | No       |
| skuId                | string             | The SKU ID from the Windows Store catalog. An example SKU ID is “0010”.                                                                            | Yes      |
| skuType              | string             | Type of the SKU. Possible values include **Trial**, **Full**, and **Rental**.                                                                      | Yes      |
| startDate            | datetime           | The date that the item starts being valid.                                                                                                         | Yes      |
| status               | string             | The status of the item. Possible values include **Active**, **Expired**, **Revoked**, and **Banned**.                                              | Yes      |
| tags                 | string             | N/A                                                                                                                                                | Yes      |
| transactionId        | guid               | The transaction ID as a result of the purchase of this item. Can be used for reporting an item as fulfilled.                                       | Yes      |

<span/> 

The IdentityContractV6 object contains the following parameters.

| Parameter     | Type   | Description                                                                        | Required |
|---------------|--------|------------------------------------------------------------------------------------|----------|
| identityType  | string | Contains the value **"pub"**.                                                      | Yes      |
| identityValue | string | The string value of the *publisherUserId* from the specified Windows Store ID key. | Yes      |

<span/> 

### Response example

```syntax
HTTP/1.1 200 OK
Content-Length: 7241
Content-Type: application/json
MS-CorrelationId: 699681ce-662c-4841-920a-f2269b2b4e6c
MS-RequestId: a9988cf9-652b-4791-beba-b0e732121a12
MS-CV: xu2HW6SrSkyfHyFh.0.1
MS-ServerId: 020022359
Date: Tue, 22 Sep 2015 20:28:18 GMT

{
  "items" : [
    {
      "acquiredDate" : "2015-09-22T19:22:51.2068724+00:00",
      "devOfferId" : "f9587c53-540a-498b-a281-8a349491ed47",
      "endDate" : "9999-12-31T23:59:59.9999999+00:00",
      "fulfillmentData" : [],
      "inAppOfferToken" : "consumable2",
      "itemId" : "4b8fbb13127a41f299270ea668681c1d",
      "localTicketReference" : "1055521810674918",
      "modifiedDate" : "2015-09-22T19:22:51.2513155+00:00",
      "orderId" : "4ba5960d-4ec6-4a81-ac20-aafce02ddf31",
      "ownershipType" : "OwnedByBeneficiary",
      "productId" : "9NBLGGH5WVP6",
      "productType" : "UnmanagedConsumable",
      "purchaser" : {
        "identityType" : "pub",
        "identityValue" : "user123"
      },
      "skuId" : "0010",
      "skuType" : "Full",
      "startDate" : "2015-09-22T19:22:51.2068724+00:00",
      "status" : "Active",
      "tags" : [],
      "transactionId" : "4ba5960d-4ec6-4a81-ac20-aafce02ddf31"
    }
  ]
}
```

## Related topics

* [View and grant products from a service](view-and-grant-products-from-a-service.md)
* [Report consumable products as fulfilled](report-consumable-products-as-fulfilled.md)
* [Grant free products](grant-free-products.md)
* [Renew a Windows Store ID key](renew-a-windows-store-id-key.md)



<!--HONumber=Aug16_HO5-->


