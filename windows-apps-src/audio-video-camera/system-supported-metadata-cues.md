---
author: drewbatgit
ms.assetid: F28162D4-AACC-4EE0-B243-5878F870F87F
description: Gérer les indicateurs de métadonnées pris en charge par le système pendant la lecture multimédia
title: Indicateurs de métadonnées synchronisées pris en charge par le système
ms.author: drewbat
ms.date: 04/18/2017
ms.topic: article
keywords: windows10, uwp, métadonnées, indicateurs, fonctions vocales, chapitre
ms.localizationpriority: medium
ms.openlocfilehash: 1e97c913764db24c68ce7becdba0fc283e1a3b73
ms.sourcegitcommit: 38f06f1714334273d865935d9afb80efffe97a17
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/09/2018
ms.locfileid: "6185380"
---
# <a name="system-supported-timed-metadata-cues"></a>Indicateurs de métadonnées synchronisées pris en charge par le système
Cet article décrit comment tirer parti de plusieurs formats de métadonnées synchronisées qui peuvent être incorporés dans des fichiers ou flux multimédia. Les applications UWP peuvent s’inscrire aux événements qui sont déclenchés par le pipeline multimédia pendant la lecture à chaque fois que ces indicateurs de métadonnées sont rencontrés. En utilisant la classe [**DataCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.DataCue), les applications peuvent implémenter leurs propres indicateurs de métadonnées personnalisés, mais cet article se concentre sur plusieurs normes de métadonnées qui sont détectées automatiquement par le pipeline multimédia, notamment:

* Sous-titres basés sur une image au format VobSub
* Signaux de reconnaissance vocale, notamment les limites de mots, les limites de phrases et les signets SSML (Speech Synthesis Markup Language)
* Indicateurs de chapitres
* Commentaires M3U étendus
* BalisesID3
* Boîtes de message électronique mp4 fragmentées


Cet article repose sur les concepts abordés dans l’article [Éléments, playlists et pistes multimédias](media-playback-with-mediasource.md), à savoir les notions de base de l’utilisation des classes [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource), [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) et [**TimedMetadataTrack**](https://msdn.microsoft.com/library/windows/apps/dn956580) et des conseils généraux pour l’utilisation des métadonnées synchronisées dans votre application.

Les étapes d’implémentation de base sont identiques pour les différents types de métadonnées synchronisées décrits dans cet article:

1. Créez un élément [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource), puis un élément [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) pour le contenu à lire.
2. Inscrivez-vous à l’événement [**MediaPlaybackItem.TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), qui se produit lorsque les sous-pistes de l’élément multimédia sont résolues par le pipeline multimédia.
3. Inscrivez-vous aux événements [**TimedMetadataTrack.CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) et [**TimedMetadataTrack.CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited) pour les pistes de métadonnées synchronisées que vous souhaitez utiliser.
4. Dans le gestionnaire d’événements **CueEntered**, mettez à jour votre interface utilisateur en fonction des métadonnées transmises dans les arguments d’événement. Vous pouvez de nouveau mettre à jour l’interface utilisateur pour supprimer le texte du sous-titre actuel par exemple, dans l’événement **CueExited**.

Dans cet article, la gestion de chaque type de métadonnées est présentée sous la forme d’un scénario distinct, mais il est possible de gérer (ou d’ignorer) différents types de métadonnées à l’aide d’un code partagé majoritairement. Vous pouvez vérifier la propriété [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) de l’objet [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) en plusieurs points du processus. Par exemple, vous pouvez choisir de vous inscrire à l’événement **CueEntered** pour les pistes de métadonnées pourvues de la valeur **TimedMetadataKind.ImageSubtitle**, mais pas pour les pistes dotées de la valeur **TimedMetadataKind.Speech**. Vous pouvez préférer inscrire un gestionnaire pour tous les types de piste de métadonnées, puis vérifier la valeur **TimedMetadataKind** dans le gestionnaire **CueEntered** pour déterminer l’action à entreprendre en réponse au signal.

## <a name="image-based-subtitles"></a>Sous-titres basés sur une image
Depuis Windows10, version1703, les applications UWP peuvent prendre en charge des sous-titres basés sur une image externe au format VobSub. Pour utiliser cette fonctionnalité, commencez par créer un objet [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) pour le contenu multimédia pour lequel les sous-titres d’image seront affichés. Créez alors un objet [**TimedTextSource**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource) en appelant [**CreateFromUriWithIndex**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.CreateFromUriWithIndex) ou [**CreateFromStreamWithIndex**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.CreateFromStreamWithIndex), en transmettant l’URI du fichier .sub contenant les données d’images de sous-titres et le fichier .idx contenant les informations de synchronisation des sous-titres. Ajoutez l’objet **TimedTextSource** à l’objet **MediaSource** en l’ajoutant à la collection [**ExternalTimedTextSources**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.ExternalTimedTextSources) de la source. Créez un objet [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) à partir de l’objet **MediaSource**.

[!code-cs[ImageSubtitleLoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitleLoadContent)]

Inscrivez-vous aux événements de métadonnées de sous-titre d’image à l’aide de l’objet **MediaPlaybackItem** créé à l’étape précédente. Cet exemple utilise une méthode d’assistance, **RegisterMetadataHandlerForImageSubtitles**, pour l’inscription aux événements. Une expression lambda permet d’implémenter un gestionnaire pour l’événement [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), qui se produit lorsque le système détecte un changement dans les pistes de métadonnées associées à un objet **MediaPlaybackItem**. Dans certains cas, les pistes de métadonnées peuvent être disponibles lorsque l’élément de lecture est initialement résolu. En dehors du gestionnaire **TimedMetadataTracksChanged**, nous parcourons également les pistes de métadonnées disponibles et appelons **RegisterMetadataHandlerForImageSubtitles**.

[!code-cs[ImageSubtitleTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitleTracksChanged)]

Après l’inscription aux événements de métadonnées de sous-titre d’image, l’élément **MediaItem** est attribué à un élément [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) pour la lecture au sein d’un élément [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[ImageSubtitlePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitlePlay)]

Dans la méthode d’assistance **RegisterMetadataHandlerForImageSubtitles**, obtenez une instance de la classe [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) en l’indexant dans la collection **TimedMetadataTracks** de l’objet **MediaPlaybackItem**. Inscrivez-vous aux événements [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) et [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Vous devez alors appeler [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) dans la collection **TimedMetadataTracks** de l’élément de lecture pour indiquer au système que l’application souhaite recevoir des événements d’indicateur de métadonnées pour cet élément de lecture.

[!code-cs[RegisterMetadataHandlerForImageSubtitles](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForImageSubtitles)]

Dans le gestionnaire de l’événement **CueEntered**, vous pouvez vérifier la propriété [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) de l’objet [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) transmis au gestionnaire pour voir si les métadonnées existent pour les sous-titres d’image. Cela est nécessaire si vous utilisez le même gestionnaire d’événements d’indicateurs de données pour plusieurs types de métadonnées. Si la piste de métadonnées associée est de type **TimedMetadataKind.ImageSubtitle**, diffusez l’indicateur de données contenu dans la propriété **Cue** de [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) vers un élément [**ImageCue**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue). La propriété [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.SoftwareBitmap) de l’élément **ImageCue** contient une représentation [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap) de l’image de sous-titre. Créez un élément [**SoftwareBitmapSource**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource) et appelez [**SetBitmapAsync**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource.SetBitmapAsync) pour attribuer l’image à un contrôle [**Image**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.image) XAML. Les propriétés [**Extent**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.Extent) et [**Position**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.Position) de l’élément **ImageCue** fournissent des informations sur la taille et la position de l’image de sous-titre.

[!code-cs[ImageSubtitleCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitleCueEntered)]

## <a name="speech-cues"></a>Signaux de reconnaissance vocale
Depuis Windows10, version1703, les applications UWP peuvent s’inscrire pour recevoir des événements en réponse aux limites de mots, limites de phrases et signets SSML (Speech Synthesis Markup Language) dans les médias lus. Cela vous permet de lire les flux audio générés avec la classe [**SpeechSynthesizer**](https://docs.microsoft.com/uwp/api/Windows.Media.SpeechSynthesis.SpeechSynthesizer) et de mettre à jour votre interface utilisateur en fonction de ces événements, tels que l’affichage du texte du mot ou de la phrase en cours de lecture.

L’exemple indiqué dans cette section utilise une variable de membre de classe pour stocker une chaîne de texte qui sera synthétisée et lue.

[!code-cs[SpeechInputText](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechInputText)]

Créez une instance de la classe **SpeechSynthesizer**. Définissez les options [**IncludeWordBoundaryMetadata**](https://docs.microsoft.com/uwp/api/windows.media.speechsynthesis.speechsynthesizeroptions.IncludeWordBoundaryMetadata) et [**IncludeSentenceBoundaryMetadata**](https://docs.microsoft.com/uwp/api/windows.media.speechsynthesis.speechsynthesizeroptions.IncludeSentenceBoundaryMetadata) du synthétiseur sur **true** pour spécifier que les métadonnées doivent être incluses dans le flux multimédia généré. Appelez [**SynthesizeTextToStreamAsync**](https://docs.microsoft.com/uwp/api/Windows.Media.SpeechSynthesis.SpeechSynthesizer.SynthesizeTextToStreamAsync) pour générer un flux contenant la synthèse vocale et les métadonnées correspondantes. Créez un objet [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) et un objet [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) à partir du flux de synthèse.

[!code-cs[SynthesizeSpeech](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSynthesizeSpeech)]

Inscrivez-vous aux événements de métadonnées vocales à l’aide de l’objet **MediaPlaybackItem**. Cet exemple utilise une méthode d’assistance, **RegisterMetadataHandlerForSpeech**, pour l’inscription aux événements. Une expression lambda permet d’implémenter un gestionnaire pour l’événement [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), qui se produit lorsque le système détecte un changement dans les pistes de métadonnées associées à un objet **MediaPlaybackItem**.  Dans certains cas, les pistes de métadonnées peuvent être disponibles lorsque l’élément de lecture est initialement résolu. En dehors du gestionnaire **TimedMetadataTracksChanged**, nous parcourons également les pistes de métadonnées disponibles et appelons **RegisterMetadataHandlerForSpeech**.

[!code-cs[SpeechTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechTracksChanged)]

Après l’inscription aux événements de métadonnées vocales, l’élément **MediaItem** est attribué à un élément [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) pour la lecture au sein d’un élément [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[SpeechPlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechPlay)]

Dans la méthode d’assistance **RegisterMetadataHandlerForSpeech**, obtenez une instance de la classe [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) en l’indexant dans la collection **TimedMetadataTracks** de l’objet **MediaPlaybackItem**. Inscrivez-vous aux événements [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) et [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Vous devez alors appeler [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) dans la collection **TimedMetadataTracks** de l’élément de lecture pour indiquer au système que l’application souhaite recevoir des événements d’indicateur de métadonnées pour cet élément de lecture.

[!code-cs[RegisterMetadataHandlerForWords](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForWords)]

Dans le gestionnaire de l’événement **CueEntered**, vous pouvez vérifier la propriété [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) de l’objet [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) transmis au gestionnaire pour voir si les métadonnées existent pour la voix. Cela est nécessaire si vous utilisez le même gestionnaire d’événements d’indicateurs de données pour plusieurs types de métadonnées. Si la piste de métadonnées associée est de type **TimedMetadataKind.Speech**, diffusez l’indicateur de données contenu dans la propriété **Cue** de [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) vers un élément [**SpeechCue**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue). Le type de signal de reconnaissance vocale inclus dans la piste de métadonnées est déterminé par la vérification de la propriété **Label**. Cette propriété a la valeur «SpeechWord» pour les limites de mots, «SpeechSentence» pour les limites de phrases ou «SpeechBookmark» pour les signets SSML. Dans cet exemple, nous recherchons la valeur «SpeechWord», et si cette valeur est trouvée, les propriétés [**StartPositionInInput**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue.StartPositionInInput) et [**EndPositionInInput**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue.EndPositionInInput) de l’élément **SpeechCue** permettent de déterminer l’emplacement du mot actuellement lu dans le texte entré. Cet exemple transmet simplement chaque mot vers la sortie de débogage.

[!code-cs[SpeechWordCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechWordCueEntered)]

## <a name="chapter-cues"></a>Indicateurs de chapitres
Depuis Windows10, version1703, les applications UWP peuvent s’inscrire aux indicateurs qui correspondent à des chapitres au sein d’un élément multimédia. Pour utiliser cette fonctionnalité, créez un objet [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) pour le contenu multimédia, puis un objet [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) à partir de l’objet **MediaSource**.

[!code-cs[ChapterCueLoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCueLoadContent)]

Inscrivez-vous aux événements de métadonnées de chapitre à l’aide de l’objet **MediaPlaybackItem** créé à l’étape précédente. Cet exemple utilise une méthode d’assistance, **RegisterMetadataHandlerForChapterCues**, pour l’inscription aux événements. Une expression lambda permet d’implémenter un gestionnaire pour l’événement [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), qui se produit lorsque le système détecte un changement dans les pistes de métadonnées associées à un objet **MediaPlaybackItem**. Dans certains cas, les pistes de métadonnées peuvent être disponibles lorsque l’élément de lecture est initialement résolu. En dehors du gestionnaire **TimedMetadataTracksChanged**, nous parcourons également les pistes de métadonnées disponibles et appelons **RegisterMetadataHandlerForChapterCues**.

[!code-cs[ChapterCueTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCueTracksChanged)]

Après l’inscription aux événements de métadonnées de chapitre, l’élément **MediaItem** est attribué à un élément [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) pour la lecture au sein d’un élément [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[ChapterCuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCuePlay)]

Dans la méthode d’assistance **RegisterMetadataHandlerForChapterCues**, obtenez une instance de la classe [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) en l’indexant dans la collection **TimedMetadataTracks** de l’objet **MediaPlaybackItem**. Inscrivez-vous aux événements [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) et [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Vous devez alors appeler [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) dans la collection **TimedMetadataTracks** de l’élément de lecture pour indiquer au système que l’application souhaite recevoir des événements d’indicateur de métadonnées pour cet élément de lecture.

[!code-cs[RegisterMetadataHandlerForChapterCues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForChapterCues)]

Dans le gestionnaire de l’événement **CueEntered**, vous pouvez vérifier la propriété [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) de l’objet [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) transmis au gestionnaire pour voir si les métadonnées existent pour les indicateurs de chapitres. Cela est nécessaire si vous utilisez le même gestionnaire d’événements d’indicateurs de données pour plusieurs types de métadonnées. Si la piste de métadonnées associée est de type **TimedMetadataKind.Chapter**, diffusez l’indicateur de données contenu dans la propriété **Cue** de [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) vers un élément [**ChapterCue**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue). La propriété [**Title**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue.Title) de l’élément **ChapterCue** contient le titre du chapitre qui vient d’être atteint lors de la lecture.

[!code-cs[ChapterCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCueEntered)]

### <a name="seek-to-the-next-chapter-using-chapter-cues"></a>Rechercher le chapitre suivant à l’aide des indicateurs de chapitres
En plus de recevoir des notifications lorsque le chapitre actuel change dans un élément en cours de lecture, vous pouvez utiliser des indicateurs de chapitres pour rechercher le chapitre suivant au sein d’un élément en cours de lecture. L’exemple de méthode indiqué ci-dessous prend en tant qu’arguments les éléments [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) et [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) représentant l’élément multimédia en cours de lecture. La collection [**TimedMetadataTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracks) fait l’objet d’une recherche pour voir si l’une des pistes possède la propriété [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) de la valeur [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) de **TimedMetadataKind.Chapter**.  Si une piste chapitre est trouvée, la méthode parcourt chaque indicateur de la collection [**Cues**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.Cues) de la piste pour rechercher le premier indicateur ayant une valeur [**StartTime**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue.StartTime) supérieure à l’élément [**Position**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacksession.Position) actuel de la session de lecture du lecteur multimédia. Lorsque l’indicateur approprié est trouvé, la position de la session de lecture est mise à jour, tout comme le titre du chapitre dans l’interface utilisateur.

[!code-cs[GoToNextChapter](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetGoToNextChapter)]

## <a name="extended-m3u-comments"></a>Commentaires M3U étendus
Depuis Windows10, version1703, les applications UWP peuvent s’inscrire aux indicateurs qui correspondent à des commentaires au sein d’un fichier manifeste M3U étendu. Cet exemple utilise [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource) pour lire le contenu multimédia. Pour plus d’informations, voir [Streaming adaptatif](adaptive-streaming.md). Créez un élément **AdaptiveMediaSource** pour le contenu en appelant [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) ou [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync). Créez un objet [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) en appelant [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource), puis un objet [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) à partir de l’objet **MediaSource**.

[!code-cs[EXTM3ULoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3ULoadContent)]

Inscrivez-vous aux événements de métadonnées M3U à l’aide de l’objet **MediaPlaybackItem** créé à l’étape précédente. Cet exemple utilise une méthode d’assistance, **RegisterMetadataHandlerForEXTM3UCues**, pour l’inscription aux événements. Une expression lambda permet d’implémenter un gestionnaire pour l’événement [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), qui se produit lorsque le système détecte un changement dans les pistes de métadonnées associées à un objet **MediaPlaybackItem**. Dans certains cas, les pistes de métadonnées peuvent être disponibles lorsque l’élément de lecture est initialement résolu. En dehors du gestionnaire **TimedMetadataTracksChanged**, nous parcourons également les pistes de métadonnées disponibles et appelons **RegisterMetadataHandlerForEXTM3UCues**.

[!code-cs[EXTM3UCueTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3UCueTracksChanged)]

Après l’inscription aux événements de métadonnées M3U, l’élément **MediaItem** est attribué à un élément [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) pour la lecture au sein d’un élément [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[EXTM3UCuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3UCuePlay)]

Dans la méthode d’assistance **RegisterMetadataHandlerForEXTM3UCues**, obtenez une instance de la classe [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) en l’indexant dans la collection **TimedMetadataTracks** de l’objet **MediaPlaybackItem**. Vérifiez la propriété DispatchType de la piste de métadonnées, qui a la valeur «EXTM3U» si la piste représente des commentaires M3U. Inscrivez-vous aux événements [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) et [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Vous devez alors appeler [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) dans la collection **TimedMetadataTracks** de l’élément de lecture pour indiquer au système que l’application souhaite recevoir des événements d’indicateur de métadonnées pour cet élément de lecture.

[!code-cs[RegisterMetadataHandlerForEXTM3UCues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForEXTM3UCues)]

Dans le gestionnaire de l’événement **CueEntered**, diffusez l’indicateur de données contenu dans la propriété **Cue** de l’élément [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) vers un élément [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).  Vérifiez que l’élément **DataCue** et la propriété [**Data**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Data) de l’indicateur n’ont pas la valeur Null. Les commentaires EMU étendus sont fournis sous la forme de chaînes terminées par des caractères Null en mode Little Endian, au format UTF-16. Créez un élément **DataReader** pour lire les données d’indicateur en appelant [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer). Définissez la propriété [**UnicodeEncoding**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.UnicodeEncoding) du lecteur sur [**Utf16LE**](https://docs.microsoft.com/uwp/api/windows.storage.streams.unicodeencoding) pour lire les données au format approprié. Appelez [**ReadString**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.ReadString) pour lire les données, en spécifiant la moitié de la longueur du champ **Données**, car chaque caractère a une taille de deuxoctets, et ôtez-en un pour supprimer le caractère Null de fin. Dans cet exemple, le commentaire M3U est simplement écrit dans la sortie de débogage.

[!code-cs[EXTM3UCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3UCueEntered)]

## <a name="id3-tags"></a>BalisesID3
Depuis Windows10, version1703, les applications UWP peuvent s’inscrire aux indicateurs qui correspondent aux balises ID3 dans le contenu HLS (HTTP Live Streaming). Cet exemple utilise [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource) pour lire le contenu multimédia. Pour plus d’informations, voir [Streaming adaptatif](adaptive-streaming.md). Créez un élément **AdaptiveMediaSource** pour le contenu en appelant [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) ou [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync). Créez un objet [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) en appelant [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource), puis un objet [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) à partir de l’objet **MediaSource**.

[!code-cs[EXTM3ULoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3ULoadContent)]

Inscrivez-vous aux événements de balise ID3 à l’aide de l’objet **MediaPlaybackItem** créé à l’étape précédente. Cet exemple utilise une méthode d’assistance, **RegisterMetadataHandlerForID3Cues**, pour l’inscription aux événements. Une expression lambda permet d’implémenter un gestionnaire pour l’événement [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), qui se produit lorsque le système détecte un changement dans les pistes de métadonnées associées à un objet **MediaPlaybackItem**. Dans certains cas, les pistes de métadonnées peuvent être disponibles lorsque l’élément de lecture est initialement résolu. En dehors du gestionnaire **TimedMetadataTracksChanged**, nous parcourons également les pistes de métadonnées disponibles et appelons **RegisterMetadataHandlerForID3Cues**.

[!code-cs[ID3LoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3LoadContent)]

Après l’inscription aux événements de métadonnées ID3, l’élément **MediaItem** est attribué à un élément [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) pour la lecture au sein d’un élément [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[ID3CuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3CuePlay)]


Dans la méthode d’assistance **RegisterMetadataHandlerForID3Cues**, obtenez une instance de la classe [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) en l’indexant dans la collection **TimedMetadataTracks** de l’objet **MediaPlaybackItem**. Vérifiez la propriété DispatchType de la piste de métadonnées, qui a une valeur contenant la chaîne GUID «15260DFFFF49443320FF49443320000F» si la piste représente des balises ID3. Inscrivez-vous aux événements [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) et [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Vous devez alors appeler [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) dans la collection **TimedMetadataTracks** de l’élément de lecture pour indiquer au système que l’application souhaite recevoir des événements d’indicateur de métadonnées pour cet élément de lecture.

[!code-cs[RegisterMetadataHandlerForID3Cues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForID3Cues)]

Dans le gestionnaire de l’événement **CueEntered**, diffusez l’indicateur de données contenu dans la propriété **Cue** de l’élément [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) vers un élément [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).  Vérifiez que l’élément **DataCue** et la propriété [**Data**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Data) de l’indicateur n’ont pas la valeur Null. Les commentaires EMU étendus sont fournis sous la forme d’octets bruts dans le flux de transport (voir [http://id3.org/id3v2.4.0-structure](http://id3.org/id3v2.4.0-structure)). Créez un élément **DataReader** pour lire les données d’indicateur en appelant [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer).  Dans cet exemple, les valeurs d’en-tête de la balise ID3 sont lues à partir des données d’indicateur et écrites dans la sortie de débogage.

[!code-cs[ID3CueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3CueEntered)]

## <a name="fragmented-mp4-emsg-boxes"></a>Boîtes de message électronique mp4 fragmentées
Depuis Windows10, version1703, les applications UWP peuvent s’inscrire aux indicateurs qui correspondent aux boîtes de message électronique au sein des flux mp4 fragmentés. Ce type de métadonnées peut être utilisé, par exemple, par les fournisseurs de contenu pour indiquer aux applications clientes de lire une annonce au cours d’une diffusion de contenu dynamique. Cet exemple utilise [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource) pour lire le contenu multimédia. Pour plus d’informations, voir [Streaming adaptatif](adaptive-streaming.md). Créez un élément **AdaptiveMediaSource** pour le contenu en appelant [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) ou [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync). Créez un objet [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) en appelant [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource), puis un objet [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) à partir de l’objet **MediaSource**.

[!code-cs[EmsgLoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEmsgLoadContent)]

Inscrivez-vous aux événements de boîte de message électronique à l’aide de l’objet **MediaPlaybackItem** créé à l’étape précédente. Cet exemple utilise une méthode d’assistance, **RegisterMetadataHandlerForEmsgCues**, pour l’inscription aux événements. Une expression lambda permet d’implémenter un gestionnaire pour l’événement [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), qui se produit lorsque le système détecte un changement dans les pistes de métadonnées associées à un objet **MediaPlaybackItem**. Dans certains cas, les pistes de métadonnées peuvent être disponibles lorsque l’élément de lecture est initialement résolu. En dehors du gestionnaire **TimedMetadataTracksChanged**, nous parcourons également les pistes de métadonnées disponibles et appelons **RegisterMetadataHandlerForEmsgCues**.

[!code-cs[ID3LoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3LoadContent)]

Après l’inscription aux événements de métadonnées de boîte de message électronique, l’élément **MediaItem** est attribué à un élément [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) pour la lecture au sein d’un élément [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[EmsgCuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEmsgCuePlay)]


Dans la méthode d’assistance **RegisterMetadataHandlerForEmsgCues**, obtenez une instance de la classe [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) en l’indexant dans la collection **TimedMetadataTracks** de l’objet **MediaPlaybackItem**. Vérifiez la propriété DispatchType de la piste de métadonnées, qui a la valeur «emsg:mp4» si la piste représente des boîtes de message électronique. Inscrivez-vous aux événements [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) et [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Vous devez alors appeler [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) dans la collection **TimedMetadataTracks** de l’élément de lecture pour indiquer au système que l’application souhaite recevoir des événements d’indicateur de métadonnées pour cet élément de lecture.


[!code-cs[RegisterMetadataHandlerForEmsgCues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForEmsgCues)]


Dans le gestionnaire de l’événement **CueEntered**, diffusez l’indicateur de données contenu dans la propriété **Cue** de l’élément [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) vers un élément [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).  Vérifiez que l’objet **DataCue** n’est pas Null. Les propriétés de la boîte de message électronique sont fournies par le pipeline multimédia en tant que propriétés personnalisées dans la collection [**Properties**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Properties) de l’objet DataCue. Cet exemple tente d’extraire plusieurs valeurs de propriété différentes à l’aide de la méthode **[TryGetValue](https://docs.microsoft.com/uwp/api/windows.foundation.collections.propertyset.trygetvalue)**. Si cette méthode retourne la valeur Null, cela signifie que la propriété demandée n’est pas présente dans la boîte de message électronique. Une valeur par défaut est donc définie à la place.

La partie suivante de l’exemple illustre le scénario dans lequel une lecture d’annonce est déclenchée, ce qui est le cas lorsque la propriété *scheme_id_uri*, obtenue à l’étape précédente, a la valeur «urn: scte:scte35:2013:xml» (voir [http://dashif.org/identifiers/event-schemes/](http://dashif.org/identifiers/event-schemes/)). Notez que la norme recommande l’envoi de ce message électronique plusieurs fois pour la redondance. Cet exemple gère donc la liste des ID de message électronique qui ont déjà été traités, et traite uniquement les nouveaux messages. Créez un objet **DataReader** pour lire les données d’indicateur en appelant [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer), définissez l’encodage sur UTF-8 à l’aide de la propriété [**UnicodeEncoding**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.UnicodeEncoding), puis lisez les données. Dans cet exemple, la charge utile de message est écrite dans la sortie de débogage. Une application réelle utiliserait les données de la charge utile pour planifier la lecture d’une annonce.

[!code-cs[EmsgCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEmsgCueEntered)]


## <a name="related-topics"></a>Rubriquesassociées

* [Lecture de contenu multimédia](media-playback.md)
* [Éléments, playlists et pistes multimédias](media-playback-with-mediasource.md)


 




